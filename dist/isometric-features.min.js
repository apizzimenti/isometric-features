/*! iso-game-features - v0.0.1 - 2016-09-01
* Copyright (c) 2016 ; Licensed MIT */
"use strict";function determineBounds(a){var b=a.sprite,c={};return b.tile.top.blocked?c.top=!0:c.top=!1,b.tile.left.blocked?c.left=!0:c.left=!1,b.tile.bottom.blocked?c.bottom=!0:c.bottom=!1,b.tile.right.blocked?c.right=!0:c.right=!1,c.allBounds=c.top||c.left||c.bottom||c.right,c}function isInBounds(a){var b=a.threeD.x,c=a.threeD.y,d=a.game,e=b>d.physics.isoArcade.bounds.backX&&b<d.physics.isoArcade.bounds.frontX,f=c>d.physics.isoArcade.bounds.backY&&c<d.physics.isoArcade.bounds.frontY;return e&&f}function dim(a,b,c){return c?a*(b-(c+1)):a-b}function direction(a){a.auto&&_assignDirection(a)}function _assignDirection(a){var b=a.sprite,c=b.body.frontX,d=b.body.frontY,e=a.map.tileMap,f=a.map.tileSize,g=Math.ceil(c/f)>=e.length-1?e.length-1:Math.ceil(c/f),h=Math.ceil(d/f)>=e[0].length-1?e[0].length-1:Math.ceil(d/f),i=b.direction,j=determineTileRadius(e.length,g),k=determineTileRadius(e[0].length,h),l=j.p,m=j.m,n=k.p,o=k.m;switch(b.row=g,b.col=h,b.tile.center=e[g][h],i){case 0:b.tile.top=e[l][h],b.tile.left=e[g][o],b.tile.right=e[g][n],b.tile.bottom=e[m][h];break;case 1:b.tile.top=e[g][o],b.tile.left=e[m][h],b.tile.right=e[l][h],b.tile.bottom=e[g][n];break;case 2:b.tile.top=e[m][h],b.tile.left=e[g][n],b.tile.right=e[g][o],b.tile.bottom=e[l][h];break;case 3:b.tile.top=e[g][n],b.tile.left=e[l][h],b.tile.right=e[m][h],b.tile.bottom=e[g][o]}b.loadTexture(a.keys[i])}function determineTileRadius(a,b){return{m:b>0?b-1:b,p:a-1>b?b+1:b}}function manipulateDirection(a,b){var c=20,d=a.sprite;switch(b){case 0:d.body.velocity.x=c,d.body.velocity.y=0,d.direction=0;break;case 1:d.body.velocity.x=0,d.body.velocity.y=-c,d.direction=1;break;case 2:d.body.velocity.x=-c,d.body.velocity.y=0,d.direction=2;break;case 3:d.body.velocity.x=0,d.body.velocity.y=c,d.direction=3}}function determineDirections(a){for(var b,c,d,e,f=[],g=0;g<a.length;g++){if(!(g+1<a.length))return f;b=a[g].x,c=a[g].y,d=a[g+1].x,e=a[g+1].y,b>d?f.push(2):d>b?f.push(0):c>e?f.push(1):e>c&&f.push(3)}}function resetSprite(a,b){var c=a.sprite;c.body.velocity.x=0,c.body.velocity.y=0,c.direction=0,c.body.moves=!b}function Debug(a){var b=this;this.game=a,this.x=this.game.width/2,this.y=20,this.color="#FFF",this.on=!1;var c=a.add.graphics(0,0);c.fixedToCamera=!0,c.lineStyle(1,16777215,0),c.beginFill(0,16777215,0),this.graphics=c,this.button=c.drawRect(20,50,62,25),this.button.inputEnabled=!0,this.button.input.useHandCursor=!0,this.text=this.game.add.text(25,50,"debug",{font:"Courier",fontSize:20,fill:"white"}),this.text.fixedToCamera=!0,this.button.events.onInputDown.add(function(){b._switch()})}function Mouse(a,b,c){this.game=a,this.map=b,this.group=c,this.pos=new Phaser.Plugin.Isometric.Point3;var d=this.game.input.mousePointer.x,e=this.game.input.mousePointer.y;this.twoD=new Phaser.Point(d,e),this.threeD=this.game.iso.unproject(this.twoD,this.pos),this["switch"]=!1,this.tile={},this.mouse=this.game.input}function keymap(a,b){return b.cursors=a.input.keyboard.createCursorKeys(),b.game.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN]),{esc:a.input.keyboard.addKey(Phaser.Keyboard.ESC),space:a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)}}function keymapTrack(a,b){var c=50,d=a.sprite;d.body.velocity.z=0,b.cursors.up.isDown?(d.body.velocity.y=-c,d.direction=1):b.cursors.down.isDown?(d.body.velocity.y=c,d.direction=3):d.body.velocity.y=0,b.cursors.left.isDown?(d.body.velocity.x=-c,d.direction=2):b.cursors.right.isDown?(d.body.velocity.x=c,d.direction=0):d.body.velocity.x=0}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function Animal(a,b,c,d,e,f,g,h,i,j){var k,l;this.type="animal",this.species=h||e[0],i?this.scale=Array.isArray(i)?i:[i]:this.scale=[1],void 0!==j?this.auto=j:this.auto=!0,this.game=a,this.scope=b,this.keys=e,this.map=g;var m=c*g.tileSize,n=d*g.tileSize;this.sprite=this.game.add.isoSprite(m,n,0,e[0],null,f),this.sprite.tile={},(k=this.sprite.anchor).set.apply(k,_toConsumableArray(Globals.anchor)),this.game.physics.isoArcade.enable(this.sprite),this.sprite.enableBody=!0,this.sprite.body.collideWorldBounds=!0,this.sprite.visible=!this.map.fog,(l=this.sprite.scale).setTo.apply(l,_toConsumableArray(this.scale)),this.scanned=!1,this.scan=new Phaser.Signal,this.listen(),direction(this)}function createAnimals(a,b,c,d,e,f,g){for(var h,i,j,k=[],l=f.tileMap.length-1,m=0;b>m;m++)i=Math.floor(Math.random()*l),j=Math.floor(Math.random()*l),h=new Animal(c,a,i,j,d,e,f,g[m]),h.id=m,k.push(h);return k}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function Item(a,b,c,d){this.keys=[b,b,b,b],this.game=a,this.key=b,d?this.name=d:this.name=b,this.inventory=c,this.text={},this.inventorySprite={},this.sprite={},this.sprite.tile={},this.sprite.direction=0,this.map=this.inventory.map,this.auto=!0}function Map(a,b,c,d,e,f,g){var h,i=[],j=[],k=f||this._createTileMap(e),l=dim(d,e,1),m=a.cache.checkImageKey(c),n=null;this.game=a,this.tileSet=c,this.tileSize=d,this.mapSize=e,this.group=b,this.fog=g,m?(this._generateMapKeys(),n=Globals.mapTileKey[3]):n=null;for(var o=0;o<k.length;o++){i[o]=[],j[o]=[];for(var p=0;p<k[0].length;p++)h=this.game.add.isoSprite(o*this.tileSize,p*this.tileSize,0,this.tileSet,n,this.group),p>k.length-2||1>o||o>k.length-2||1>p?(h.tint=this.fog?5709655:16777215,h.blocked=!0,j[o].push(0)):(h.blocked=!1,h.tint=this.fog?5709655:16777215,j[o].push(1)),h.discovered=this.fog?!1:!0,h.type="tile",h.anchor.set(.5,1),h.smoothed=!1,h.row=o,h.col=p,i[o][p]=h,h.compareTo=function(a){var b=this.row===a.row,c=this.col===a.col;return b&&c?!0:void 0}}this.game.physics.isoArcade.bounds.frontX=l,this.game.physics.isoArcade.bounds.frontY=l,this.game.physics.isoArcade.bounds.backX=0,this.game.physics.isoArcade.bounds.backY=0,this.tileMap=i,this.blocked=j}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function Player(a,b,c,d,e,f,g,h){var i,j;this.type="player",this.map=f,void 0!==h?this.auto=h:this.auto=!0;var k=b*this.map.tileSize,l=c*this.map.tileSize;this.game=a,this.keys=d,this.group=e,g?this.scale=Array.isArray(g)?g:[g]:this.scale=[1],this.sprite=this.game.add.isoSprite(k,l,0,d[0],null,e),(i=this.sprite.anchor).set.apply(i,_toConsumableArray(Globals.anchor)),this.sprite.body.collideWorldBounds=!0,this.sprite.body.moves=!1,(j=this.sprite.scale).setTo.apply(j,_toConsumableArray(this.scale)),this.sprite.visible=!1,this.game.camera.follow(this.sprite),this.auto&&this.create()}function ContextMenu(a){this.Inventory=a,this.game=this.Inventory.game,this.mouse=this.Inventory.mouse,this.items=this.Inventory.items}function Guide(a,b,c,d){var e=this;this.raw={},this.raw.buttonOptions=c||null,this.raw.buttonOptions["default"]={color:"#FFF",border:"none","font-size":"20px","background-color":"transparent"},this.raw.guideId=a,this.raw.canvasId=b,this.raw.guide=document.getElementById(a),this.raw.game=document.getElementById(b),this.raw.canvas=this.raw.game.getElementsByTagName("canvas")[0],this.raw.guideHtml=this.raw.guide.innerHTML,this.raw.offsetTop=this.raw.canvas.offsetTop,this.raw.offsetLeft=this.raw.canvas.offsetLeft,this.raw.on=!1,this.raw.guide.styles=d||null,$(document).ready(function(){e.guideElement=$("#"+a),e._configureWindow(),e._button()})}function Inventory(a,b,c,d,e,f){this.game=a,this.width=this.game.width,this.height=this.game.height,this.mouse=c,this.escape=d,this.times=0,this.map=b,this.items=[],this.itemCache={},this.itemsRow=[];var g=a.add.graphics(0,0),h=a.add.group(),i=260,j=300,k=65,l=60;this.i=j,this.j=i,h.fixedToCamera=!0,h.enableBody=!0,this.menuGroup=h,this.itemGroup=e,g.fixedToCamera=!0,g.lineStyle(2,16711680,.5),g.beginFill(16711680,.3),g.drawRect(this.width-i,this.height-j,i,j),this.graphics=g,this.area={},this.area.width=i,this.area.height=j,this.element={},this.element.width=k,this.element.height=l,window.graphics=g,this.messages=new Message(this.game,14,f),this.contextMenu=new ContextMenu(this),this._onClick()}function Message(a,b,c){var d=this;this.game=a,this.y=this.game.height,this.messages=[],this.loc=c,this.fontSize=b,this.style={font:b+"px Courier",fill:"#FFFFFF"},this.alert=new Phaser.Signal,this.alert.add(function(){d._display()})}function Message(a,b,c){var d=this;this.game=a,this.y=this.game.height,this.message="",this.loc=c,this.fontSize=b,this.style={font:b+"px Courier",fill:"#FFFFFF"},this.alert=new Phaser.Signal,this.alert.add(function(){d.display()})}Debug.prototype.fps=function(){this.on&&this.game.debug.text(this.game.time.fps,this.x,this.y,this.color)},Debug.prototype.mousePos=function(a){this.on&&this.game.debug.text(a.row+", "+a.col,this.x,this.y+20,this.color)},Debug.prototype.sprite=function(a){var b=this;if(this.on){var c=function(a){try{var c=a.sprite;if(b.game.debug.body(c,"#FFFFFF",!1),c.tile&&b.game.debug.body(c.tile.top,"#FF0000",!1),c.tile)for(var d in c.tile)c.tile.hasOwnProperty(d)&&"top"!==d&&b.game.debug.body(c.tile[d],"#FFDD00",!1)}catch(e){console.warn(a.type+" is not yet loaded")}};if(Array.isArray(a)){var d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;c(i)}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}}else c(a)}},Debug.prototype.tiles=function(a){if(this.on)for(var b=0;b<a.length;b++)for(var c=0;c<a[0].length;c++){var d=a[b][c];d.blocked&&this.game.debug.body(a[b][c],"#FFDD00",!1)}},Debug.prototype._switch=function(){this.on=!this.on};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},Globals={anchor:[.5,0],mapTileKey:[],tween:[1e3,Phaser.Easing.Linear.None,!0,0,0,!1],paramNotExist:function(a,b){return("undefined"==typeof a?"undefined":_typeof(a))!==b||void 0==a}};Mouse.prototype.update=function(){this.twoD.x=this.game.input.mousePointer.x,this.twoD.y=this.game.input.mousePointer.y,this.threeD=this.game.iso.unproject(this.twoD,this.pos);var a=this.game.physics.isoArcade.bounds.backX,b=this.game.physics.isoArcade.bounds.backY,c=this.game.physics.isoArcade.bounds.frontX,d=this.game.physics.isoArcade.bounds.frontY;this.inBounds=this.threeD.x>a&&this.threeD.x<c&&this.threeD.y>b&&this.threeD.y<d},Mouse.prototype.selected=function(){var a=this;this.inBounds?this.group.forEach(function(b){if("tile"===b.type){var c=b.isoBounds.containsXY(a.threeD.x+a.map.tileSize,a.threeD.y+a.map.tileSize);c?(a.tile=b,a.row=a.tile.row,a.col=a.tile.col,b.tint=10025880,b.alpha=1.3+Math.sin(.007*a.game.time.now),a.tween=a.game.add.tween(b).to({isoZ:5},20,Phaser.Easing.Linear.None,!0),a.tweened=!0):(a.tweened&&(a.tween.stop(),a.tweened=!a.tweened,b.isoZ=0),b.discovered?b.tint=16777215:b.tint=5709655,b.alpha=1)}}):this.reset()},Mouse.prototype.reset=function(){var a=this;this.group.forEach(function(b){"tile"===b.type&&(b.discovered?b.tint=16777215:b.tint=5709655,b.alpha=1,b.isoZ=0,a.game.canvas.style.cursor="default")})},Animal.prototype.isVisible=function(a){if(a.auto){var b=a.row,c=a.col,d=this.sprite.row,e=this.sprite.col,f=d>=b-1&&b+1>=d,g=e>=c-1&&c+1>=e;f&&g&&(this.sprite.visible=!0),this.sprite.tile.center.discovered?this.sprite.visible=!0:this.sprite.visible=!1}},Animal.prototype._instantiate=function(){},Animal.prototype.timedMovement=function(){var a=this,b=0;this.rand=3*Math.random(),this.loopedMovement=this.game.time.events.loop(3*Phaser.Timer.SECOND+this.rand,function(){b=Math.floor(4*Math.random()),a.rand=3*Math.random(),manipulateDirection(a,b)})},Animal.prototype.listen=function(){var a=this;this.scan.add(function(){a.scope.$emit("scanned",{animal:a})}),this.scope.$on("pathfind",function(b,c){a._pathfind(c.row,c.col)})},Animal.prototype._pathfind=function(a,b){var c=this,d=new EasyStar.js,e=this.sprite.row,f=this.sprite.col,g=[];d.setGrid(this.map.blocked),d.setAcceptableTiles([1]),d.setIterationsPerCalculation(1e3),d.findPath(e,f,a,b,function(a){a?(c.game.time.events.remove(c.loopedMovement),g=determineDirections(a),resetSprite(c,!0),c._followDirection(!0,a,g)):console.log("path not found")}),d.calculate()},Animal.prototype._followDirection=function(a,b,c){var d,e=this,f=this.map.tileSize,g=b[0].x,h=b[0].y,i=g*f,j=h*f,k=0===c.length||1===b.length;if(a){var l;this.sprite.tween=(l=this.game.add.tween(this.sprite)).to.apply(l,[{isoX:i,isoY:j}].concat(_toConsumableArray(Globals.tween))),this.sprite.tween.onComplete.add(function(){e.sprite.direction=c[0],b.splice(0,1),c.splice(0,1),e._followDirection(!1,b,c)})}else if(a||k)!a&&k&&(resetSprite(this,!1),this.timedMovement());else{var m;d=this.game.add.tween(this.sprite),this.sprite.tween.chain((m=d).to.apply(m,[{isoX:i,isoY:j}].concat(_toConsumableArray(Globals.tween)))),d.onComplete.add(function(){e.sprite.direction=c[0],b.splice(0,1),c.splice(0,1),e._followDirection(!1,b,c)})}},Item.prototype.action=function(){console.warn(this.key+" is using the builtin action method")},Item.prototype.threeDInitialize=function(){var a;(a=this.sprite.anchor).set.apply(a,_toConsumableArray(Globals.anchor)),this.sprite.body.collideWorldBounds=!0,this.game.physics.isoArcade.enable(this.sprite),this.sprite.enableBody=!0,this.sprite.tile={},this.sprite.direction=0,this.sprite.body.immovable=!0,this.setting=!0,direction(this)},Map.prototype._createTileMap=function(a){for(var b=[],c=0;a>c;c++){b[c]=[];for(var d=0;a>d;d++){var e=Math.floor(3*Math.random());e>0?b[c][d]=e:b[c][d]=0}}return b},Map.prototype._generateMapKeys=function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.game.cache._cache.image[this.tileSet].frameData._frames[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;Globals.mapTileKey.push(f.name)}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},Player.prototype.create=function(){var a=this;this.sprite.visible=!0,this.intro?(this.intro.start(),this.intro.onComplete.add(function(){a._instantiate(),a.postTween&&a.postTween.f(a)})):this._instantiate()},Player.prototype._instantiate=function(){this.auto=!0,this.sprite.direction=0,this.sprite.tile={},this.sprite.body.bounce=new Phaser.Plugin.Isometric.Point3(.5,.5,.5),this.sprite.body.moves=!0},Player.prototype.addIntro=function(a,b,c){var d,e=[],f=b;if(Globals.paramNotExist(a,"object"))throw new TypeError("preTween is not of type object");if(Globals.paramNotExist(f,"object"))throw new TypeError("tweenParameters is not of type object");if(c){if(Globals.paramNotExist(c,"object"))throw new TypeError("postTween parameter is not of type object");this.postTween={},this.postTween.props=c,this.postTween.f=function(a){for(var b in a.postTween.props)a.postTween.props.hasOwnProperty(b)&&(a.sprite[b]=a.postTween.props[b])}}for(var g in a)a.hasOwnProperty(g)&&(this.sprite[g]=a[g]);if(!f.hasOwnProperty("properties"))throw new ReferenceError("tweenParameters has no defined 'properties' property");if(!f.hasOwnProperty("easing"))throw new ReferenceError("tweenParameters has no defined 'easing' property");if(!f.hasOwnProperty("duration"))throw new ReferenceError("tweenParameters has no defined 'duration' property");e[0]=f.properties,e[1]=f.duration,e[2]=f.easing,this.intro=(d=this.game.add.tween(this.sprite)).to.apply(d,e.concat([!1,0,0,!1]))},Player.prototype.addOuttro=function(a){},Player.prototype.visionRadius=function(){var a,b,c={},d=this.sprite.row,e=this.sprite.col;for(a=d-1;d+2>a;a++)for(b=e-1;e+2>b;b++)c=this.map.tileMap[a][b],c.tint=16777215,c.discovered=!0},Player.prototype._float=function(){this.sprite.isoZ=5+Math.sin(.005*this.game.time.now)},ContextMenu.prototype.createContextMenu=function(){var a=this,b=this.mouse.twoD.x,c=this.mouse.twoD.y,d=this.game.add.graphics(0,0);d.fixedToCamera=!0,d.lineStyle(2,16776960,1),d.beginFill(16776960,.4),this.graphics=d,this.menu=this.graphics.drawRect(b,c,100,150),this.mouse.mouse.onDown.add(function(){a.menu.destroy()})},Guide.prototype._button=function(){var a=document.createElement("button"),b=document.createTextNode(this.raw.buttonOptions.text||"i"),c="guideButton",d="#"+c,e=this;a.id=c,a.appendChild(b),this.raw.game.appendChild(a),this.raw.guideButton=a,this.raw.guideButton.className="guide-button",this.raw.guideButton.on=!1,this.raw.guideButton.template=d,$(d).css({top:e.raw.offsetTop+20,left:e.raw.offsetLeft+20}),this.raw.buttonOptions.style&&$(d).css(this.raw.buttonOptions.style),$(d).hover(function(){$(d).css({cursor:"pointer"}),e.raw.buttonOptions.hover&&$(d).css(e.raw.buttonOptions.hover)},function(){$(d).css({cursor:"default"}),e.raw.buttonOptions.style?$(d).css(e.raw.buttonOptions.style):$(d).css(e.raw.buttonOptions["default"])}),$(d).click(function(){e.raw.guideButton.on?(e.raw.guideButton.on=!1,$("#"+e.raw.guideId).css({display:"none"})):(e.raw.guideButton.on=!0,$("#"+e.raw.guideId).css({display:"block"}))})},Guide.prototype._configureWindow=function(){var a="#"+this.raw.guideId,b=$("#"+this.raw.canvasId).offset(),c=this.raw.canvas,d=c.width/2,e=c.height/2,f=e/2+b.top,g=(window.innerWidth-c.offsetWidth+d)/2,h=this.raw.guide;h.className="guide",$(a).css({display:"none",left:g,top:f,width:d,height:e}),this.raw.guide.styles&&$(a).css(this.raw.guide.styles)},Inventory.prototype.addItem=function(a){var b=this.element.width,c=this.element.height,d=this.width-this.j,e=this.height-this.i,f=a.name;if(a.inventorySprite=this.game.add.sprite(d,e,a.key,null,this.menuGroup),a.inventorySprite.width=b,a.inventorySprite.height=c,a.inventorySprite.row=(this.area.height-this.i)/c,a.inventorySprite.col=(this.area.width-this.j)/b,a.inventorySprite.inputEnabled=!0,a.inventorySprite.input.useHandCursor=!0,a.text=this.game.add.text(d,e,f,{font:"Courier",fontSize:12,fill:"white"}),a.text.fixedToCamera=!0,this.j-=b,this.itemsRow.push(a),this.items[a.inventorySprite.row]=this.itemsRow,this.itemCache[a.key]=a,0===this.j)this.i-=c,this.j=this.area.width,this.items[a.inventorySprite.row+1]=[],this.itemsRow=[];else if(0===this.i)throw new RangeError("Number of sprites exceeds the number of available tiles.")},Inventory.prototype.addItems=function(a){var b=this;if(!Array.isArray(a))throw new Error("Use addItem(item) for single items.");a.forEach(function(a){b.addItem(a)})},Inventory.prototype._onClick=function(){var a=this;this.game.input.onDown.add(function(){a.mouse["switch"]?a._placeItem():a._click()}),this.escape.onDown.add(function(){a.mouse["switch"]=!1,a.mouse.reset(),a._reset()})},Inventory.prototype._click=function(){var a=this;this.game.canvas.oncontextmenu=function(b){b.preventDefault(),a.contextMenu.createContextMenu()};var b=this.width-this.area.width,c=this.height-this.area.height,d=this.mouse.twoD.x-b,e=this.mouse.twoD.y-c;if(this.mouse.twoD.x>b&&this.mouse.twoD.y>c){var f,g=Math.floor(d/this.element.width),h=Math.floor(e/this.element.height);this.items[h][g]&&(f=this.items[h][g],this.currentItem&&(this.currentItem.inventorySprite.tint=16777215,this.currentItem.inventorySprite.clicked=!1,this.currentItem.inventorySprite.useHandCursor=!0),this.mouse["switch"]=!0,f.inventorySprite.clicked=!0,f.inventorySprite.tint=16768256,f.text.tint=16768256,this.currentItem=f)}},Inventory.prototype._reset=function(){var a=this;this.menuGroup.forEach(function(b){b.input.useHandCursor=!0,b.tint=16777215,a.itemCache[b.key].text.tint=16777215,b.clicked&&(b.clicked=!1)})},Inventory.prototype._placeItem=function(){var a,b,c=this.mouse.map.tileSize,d=this.mouse.threeD.x-this.mouse.threeD.x%c,e=this.mouse.threeD.y-this.mouse.threeD.y%c,f=this.currentItem,g=f.key,h=this.mouse.tile,i="Sorry, you can't place the "+g+" there. Choose a place that you've already seen!";h.discovered&&isInBounds(this.mouse)?(a=f.inventorySprite.row,b=f.inventorySprite.col,f.sprite=this.game.add.isoSprite(d,e,0,g,null,this.itemGroup),f.threeDInitialize(),f.action(),f.inventorySprite.destroy(),f.text.destroy(),this.items[a][b]=null,this.mouse.reset(),this.mouse["switch"]=!1):this.messages.add(i)},Message.prototype.add=function(a){this.messages.push(a),this.messages.length<=1&&this.alert.dispatch()},Message.prototype._display=function(){var a,b=this,c=this._format(this.messages[0]);this.text=this.game.add.text(c.x,c.y,c.msg,this.style),this.text.alpha=0,this.text.fixedToCamera=!0,this.game.add.tween(this.text).to({alpha:1},500,Phaser.Easing.Linear.None,!0,0,0,!1),this.game.time.events.add(3*Phaser.Timer.SECOND,function(){a=b.game.add.tween(b.text).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1),a.onComplete.add(function(){b.messages=b.messages.slice(1,b.messages.length),0!==b.messages.length&&b.alert.dispatch()})})},Message.prototype._format=function(a){for(var b=0,c=[],d=a.length%60?a.length-a.length%60:0,e={},f=0;f<a.length;f++)if(f%60||0===f){if(0===d&&f===a.length-1)c.push(a.slice(b,a.length));else if(f>d&&0!==d){c.push(a.slice(b,a.length));break}}else c.push(a.slice(b,f)+"\n"),b=f;switch(this.loc){case"bottom_left":default:e.x=10,e.y=this.y-c.length*this.fontSize*1.8;break;case"top_left":e.x=10,e.y=c.length*(1.8*this.fontSize);break;case"top_right":e.x=this.game.width-540,e.y=10;break;case"bottom_right":e.x=this.game.width-540,e.y=this.y-c.length*this.fontSize*1.8}return e.msg=c.join(" "),e},Message.prototype.add=function(a){this.message=a,this.alert.dispatch()},Message.prototype.display=function(){var a=this,b=this.format(this.message);this.text=this.game.add.text(b.x,b.y,b.msg,this.style),this.text.alpha=0,this.text.fixedToCamera=!0,this.game.add.tween(this.text).to({alpha:1},500,Phaser.Easing.Linear.None,!0,0,0,!1),this.game.time.events.add(5*Phaser.Timer.SECOND,function(){a.game.add.tween(a.text).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1)})},Message.prototype.format=function(a){for(var b=0,c=[],d=a.length%60?a.length-a.length%60:0,e={},f=0;f<a.length;f++)if(f%60||0===f){if(0===d&&f===a.length-1)c.push(a.slice(b,a.length));else if(f>d&&0!==d){c.push(a.slice(b,a.length));break}}else c.push(a.slice(b,f)+"\n"),b=f;switch(this.loc){case"bottom_left":default:e.x=10,e.y=this.y-c.length*this.fontSize*1.8;break;case"top_left":e.x=10,e.y=c.length*(1.8*this.fontSize);break;case"top_right":e.x=this.game.width-540,e.y=10;break;case"bottom_right":e.x=this.game.width-540,e.y=this.y-c.length*this.fontSize*1.8}return e.msg=c.join(" "),e};